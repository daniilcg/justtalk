<!DOCTYPE html>
<html>
<head>
    <title>JustTalk</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: #1a1a1a; color: white; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 300px; background: #2d2d2d; border-right: 1px solid #444; }
        .main { flex: 1; display: flex; flex-direction: column; }
        .header { padding: 20px; background: #2d2d2d; border-bottom: 1px solid #444; }
        .messages { flex: 1; padding: 20px; overflow-y: auto; }
        .message-input { padding: 20px; background: #2d2d2d; }
        input, button { padding: 10px; margin: 5px; border: none; border-radius: 5px; }
        input { width: 200px; background: #444; color: white; }
        button { background: #0084ff; color: white; cursor: pointer; }
        .message { margin: 10px 0; padding: 10px; background: #0084ff; border-radius: 10px; max-width: 70%; }
        .message.own { background: #444; margin-left: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div style="padding: 20px;">
                <input type="text" id="usernameInput" placeholder="Введите имя">
                <button onclick="register()">Войти</button>
            </div>
            <div id="contacts"></div>
        </div>
        
        <div class="main" id="mainApp" style="display: none;">
            <div class="header">
                <h3 id="currentContact">Выберите контакт</h3>
                <button onclick="startCall()">Позвонить</button>
            </div>
            <div class="messages" id="messages"></div>
            <div class="message-input">
                <input type="text" id="messageInput" placeholder="Сообщение">
                <button onclick="sendMessage()">Отправить</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let currentContact = null;
        let socket = null;

        function register() {
            const username = document.getElementById('usernameInput').value;
            if (!username) return;
            
            currentUser = username;
            socket = io();
            
            socket.emit('register', username);
            
            document.getElementById('sidebar').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            
            loadContacts();
        }

        function loadContacts() {
            socket.emit('getUsers');
            socket.on('users', (users) => {
                const contactsDiv = document.getElementById('contacts');
                contactsDiv.innerHTML = '<h3>Контакты:</h3>';
                users.forEach(user => {
                    if (user !== currentUser) {
                        const div = document.createElement('div');
                        div.innerHTML = user;
                        div.style.padding = '10px';
                        div.style.cursor = 'pointer';
                        div.style.borderBottom = '1px solid #444';
                        div.onclick = () => selectContact(user);
                        contactsDiv.appendChild(div);
                    }
                });
            });
        }

        function selectContact(contact) {
            currentContact = contact;
            document.getElementById('currentContact').textContent = contact;
            loadMessages();
        }

        function loadMessages() {
            socket.emit('getMessages', { from: currentUser, to: currentContact });
            socket.on('messages', (messages) => {
                const messagesDiv = document.getElementById('messages');
                messagesDiv.innerHTML = '';
                messages.forEach(msg => {
                    const div = document.createElement('div');
                    div.className = `message ${msg.from === currentUser ? 'own' : ''}`;
                    div.textContent = msg.text;
                    messagesDiv.appendChild(div);
                });
            });
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value;
            if (!text || !currentContact) return;
            
            socket.emit('sendMessage', {
                from: currentUser,
                to: currentContact,
                text: text
            });
            
            input.value = '';
            loadMessages();
        }

        function startCall() {
            if (!currentContact) return;
            alert(`Звонок ${currentContact} - WebRTC нужно настраивать отдельно`);
        }
    </script>
    <script src="/socket.io/socket.io.js"></script>
</body>
</html>
